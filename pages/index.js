import Head from 'next/head'
import Image from 'next/image'
import CardDisplay from '../Components/Card Display/cardDisplay'
import styles from '../styles/Home.module.css'
import Map from '../Components/map'
import FilterBar from '../Components/Filter Bar/filterBar'
import dynamic from 'next/dynamic'
import React, { useEffect, useState } from 'react'
import CategoryFilter from '../Components/Category Filter/categoryFilter'
import RegionFilter from '../Components/Region Filter/regionFilter'
 
import OutlinedInput from '@mui/material/OutlinedInput';
import InputLabel from '@mui/material/InputLabel';
import MenuItem from '@mui/material/MenuItem';
import FormControl from '@mui/material/FormControl';
import ListItemText from '@mui/material/ListItemText';
import Select from '@mui/material/Select';
import Checkbox from '@mui/material/Checkbox';

//import Select from 'react-select';
const ITEM_HEIGHT = 48;
const ITEM_PADDING_TOP = 8;
const MenuProps = {
  PaperProps: {
    style: {
      maxHeight: ITEM_HEIGHT * 4.5 + ITEM_PADDING_TOP,
      width: 250,
      color:'white',
      backgroundColor: '#225544',
    
    },
  },
};







const MapComponent = dynamic(() => import("../Components/map.js"), {
    loading: () => "Loading...",
    ssr: false
  });





export default function Home() {

  const [categoryState, setCategoryState] = useState("")
  const [allLocationData , setAllLocationData] = useState([])
  const[displayedData,setDisplayedData]= useState([])
  const [regionState, setRegionState] = useState("")
  const [amenity, setAmenity] = useState([]);

  let amenities = [ 
    "Parking",
    "Food",
    "Family",
    "Changing facilities",
    "Disability access",
    "Peaceful",
    "Electric charging",
    "No restaurants",
    "Museums",
    "Beach",
    "Hiking",
    "Pet friendly",
    "Forests",
    "Lots of wildlife",
    "Watersports",
    "Shopping",
    "Bodies of water",
    "Camping",
    "Mountains",
    "Hearing loop",
    "Public transport good",
    "Public transport bad",
    "Accommodation",
    "Wifi",
  ]
  
  


  useEffect(() => {
    const fetchData = async () => {
      const url = `https://untrodden.herokuapp.com/locations`;
      try {
        const response = await fetch(url);
        const data = await response.json();
        setAllLocationData(data.payload);
        setDisplayedData(data.payload)
              } catch (error) {
        console.log('error', error);
      }
    }
    fetchData()
  } ,[])


  function onChangeRegionState(event){
    
     setRegionState(event.target.value)
     setDisplayedData([...allLocationData.filter(location =>location.region === event.target.value)])
 }


  function onChangeCategoryState(event){
        console.log(event.target.value);
      setCategoryState(event.target.value)   
  setDisplayedData([...allLocationData.filter(location =>location.categories.includes(event.target.value))])

}

function handleChange (event) {
  const {
    target: { value },
  } = event;
  setAmenity(
    // On autofill we get a stringified value.
    typeof value === 'string' ? value.split(',') : value,
  );
  console.log(categoryState)
};


  console.log(allLocationData)

  return (
    <div className={styles.container}>
      <Head>
        <title>Untrodden</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

<section className='FilterBar'>
<RegionFilter onChange={onChangeRegionState} value={regionState}/>
<CategoryFilter onChange={onChangeCategoryState} value={categoryState} />
<div className={styles.amenities_filter}>
      <FormControl sx={{ m: 0.5, width: '15vw' }}>
        <InputLabel id="demo-multiple-checkbox-label" style={{color:'#E8A941', fontSize:'1.2vw',}} >Amenities:</InputLabel>
        <Select
          labelId="demo-multiple-checkbox-label"
          id="demo-multiple-checkbox"
          multiple
          value={amenity}
          onChange={handleChange}
          input={<OutlinedInput label="Amenities:" />}
          renderValue={(selected) => selected.join(', ')}
          MenuProps={MenuProps}
          style={{color:'white'}}
        >
          {amenities.map((amen) => (
            <MenuItem key={amen} value={amen}>
            <ListItemText primary={amen} />
              <Checkbox style={{color:'white'}} checked={amenity.indexOf(amen) > -1} />
             
            </MenuItem>
          ))}
        </Select>
      </FormControl>
    </div>
    

</section>
          
     
         <main className={styles.main}>
        <section>
          <MapComponent allLocationData={displayedData}/>
        </section>
        <section>
        <CardDisplay allLocationData={displayedData}/>
    </section>

    </main>



      
    </div>
  )
}


